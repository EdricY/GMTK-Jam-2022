/*! For license information please see game.js.LICENSE.txt */
(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{Cd:()=>Je,NE:()=>Ke,xt:()=>Qe,OC:()=>tn});let e=Float32Array;function n(t,n,r){const i=new e(3);return t&&(i[0]=t),n&&(i[1]=n),r&&(i[2]=r),i}function r(t,n,r){return(r=r||new e(3))[0]=t[0]+n[0],r[1]=t[1]+n[1],r[2]=t[2]+n[2],r}function i(t,n,r){r=r||new e(3);const i=t[2]*n[0]-t[0]*n[2],s=t[0]*n[1]-t[1]*n[0];return r[0]=t[1]*n[2]-t[2]*n[1],r[1]=i,r[2]=s,r}function s(t,n){n=n||new e(3);const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=Math.sqrt(r);return i>1e-5?(n[0]=t[0]/i,n[1]=t[1]/i,n[2]=t[2]/i):(n[0]=0,n[1]=0,n[2]=0),n}let o,a,l,c=Float32Array;function u(t,e){return(e=e||new c(16))[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function h(t){return(t=t||new c(16))[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function f(t,e){e=e||new c(16);const n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],l=t[6],u=t[7],h=t[8],f=t[9],d=t[10],p=t[11],g=t[12],m=t[13],y=t[14],w=t[15],b=d*w,v=y*p,A=l*w,x=y*u,T=l*p,E=d*u,C=i*w,M=y*s,I=i*p,S=d*s,L=i*u,R=l*s,k=h*m,P=g*f,z=o*m,U=g*a,D=o*f,B=h*a,_=n*m,F=g*r,O=n*f,X=h*r,$=n*a,V=o*r,Y=b*a+x*f+T*m-(v*a+A*f+E*m),G=v*r+C*f+S*m-(b*r+M*f+I*m),N=A*r+M*a+L*m-(x*r+C*a+R*m),W=E*r+I*a+R*f-(T*r+S*a+L*f),j=1/(n*Y+o*G+h*N+g*W);return e[0]=j*Y,e[1]=j*G,e[2]=j*N,e[3]=j*W,e[4]=j*(v*o+A*h+E*g-(b*o+x*h+T*g)),e[5]=j*(b*n+M*h+I*g-(v*n+C*h+S*g)),e[6]=j*(x*n+C*o+R*g-(A*n+M*o+L*g)),e[7]=j*(T*n+S*o+L*h-(E*n+I*o+R*h)),e[8]=j*(k*u+U*p+D*w-(P*u+z*p+B*w)),e[9]=j*(P*s+_*p+X*w-(k*s+F*p+O*w)),e[10]=j*(z*s+F*u+$*w-(U*s+_*u+V*w)),e[11]=j*(B*s+O*u+V*p-(D*s+X*u+$*p)),e[12]=j*(z*d+B*y+P*l-(D*y+k*l+U*d)),e[13]=j*(O*y+k*i+F*d-(_*d+X*y+P*i)),e[14]=j*(_*l+V*y+U*i-($*y+z*i+F*l)),e[15]=j*($*d+D*i+X*l-(O*l+V*d+B*i)),e}function d(t,e,r){r=r||n();const i=e[0],s=e[1],o=e[2],a=i*t[3]+s*t[7]+o*t[11]+t[15];return r[0]=(i*t[0]+s*t[4]+o*t[8]+t[12])/a,r[1]=(i*t[1]+s*t[5]+o*t[9]+t[13])/a,r[2]=(i*t[2]+s*t[6]+o*t[10]+t[14])/a,r}function p(t,e,r){r=r||n();const i=e[0],s=e[1],o=e[2];return r[0]=i*t[0]+s*t[4]+o*t[8],r[1]=i*t[1]+s*t[5]+o*t[9],r[2]=i*t[2]+s*t[6]+o*t[10],r}var g=Object.freeze({__proto__:null,axisRotate:function(t,e,n,r){r=r||new c(16);let i=e[0],s=e[1],o=e[2];const a=Math.sqrt(i*i+s*s+o*o);i/=a,s/=a,o/=a;const l=i*i,u=s*s,h=o*o,f=Math.cos(n),d=Math.sin(n),p=1-f,g=l+(1-l)*f,m=i*s*p+o*d,y=i*o*p-s*d,w=i*s*p-o*d,b=u+(1-u)*f,v=s*o*p+i*d,A=i*o*p+s*d,x=s*o*p-i*d,T=h+(1-h)*f,E=t[0],C=t[1],M=t[2],I=t[3],S=t[4],L=t[5],R=t[6],k=t[7],P=t[8],z=t[9],U=t[10],D=t[11];return r[0]=g*E+m*S+y*P,r[1]=g*C+m*L+y*z,r[2]=g*M+m*R+y*U,r[3]=g*I+m*k+y*D,r[4]=w*E+b*S+v*P,r[5]=w*C+b*L+v*z,r[6]=w*M+b*R+v*U,r[7]=w*I+b*k+v*D,r[8]=A*E+x*S+T*P,r[9]=A*C+x*L+T*z,r[10]=A*M+x*R+T*U,r[11]=A*I+x*k+T*D,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r},axisRotation:function(t,e,n){n=n||new c(16);let r=t[0],i=t[1],s=t[2];const o=Math.sqrt(r*r+i*i+s*s);r/=o,i/=o,s/=o;const a=r*r,l=i*i,u=s*s,h=Math.cos(e),f=Math.sin(e),d=1-h;return n[0]=a+(1-a)*h,n[1]=r*i*d+s*f,n[2]=r*s*d-i*f,n[3]=0,n[4]=r*i*d-s*f,n[5]=l+(1-l)*h,n[6]=i*s*d+r*f,n[7]=0,n[8]=r*s*d+i*f,n[9]=i*s*d-r*f,n[10]=u+(1-u)*h,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},copy:u,create:function(){return new c(16).fill(0)},frustum:function(t,e,n,r,i,s,o){const a=e-t,l=r-n,u=i-s;return(o=o||new c(16))[0]=2*i/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*i/l,o[6]=0,o[7]=0,o[8]=(t+e)/a,o[9]=(r+n)/l,o[10]=s/u,o[11]=-1,o[12]=0,o[13]=0,o[14]=i*s/u,o[15]=0,o},getAxis:function(t,e,r){const i=4*e;return(r=r||n())[0]=t[i+0],r[1]=t[i+1],r[2]=t[i+2],r},getTranslation:function(t,e){return(e=e||n())[0]=t[12],e[1]=t[13],e[2]=t[14],e},identity:h,inverse:f,lookAt:function(t,r,u,h){return h=h||new c(16),o=o||n(),a=a||n(),l=l||n(),s(function(t,n,r){return(r=r||new e(3))[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],r}(t,r,l),l),s(i(u,l,o),o),s(i(l,o,a),a),h[0]=o[0],h[1]=o[1],h[2]=o[2],h[3]=0,h[4]=a[0],h[5]=a[1],h[6]=a[2],h[7]=0,h[8]=l[0],h[9]=l[1],h[10]=l[2],h[11]=0,h[12]=t[0],h[13]=t[1],h[14]=t[2],h[15]=1,h},multiply:function(t,e,n){n=n||new c(16);const r=t[0],i=t[1],s=t[2],o=t[3],a=t[4],l=t[5],u=t[6],h=t[7],f=t[8],d=t[9],p=t[10],g=t[11],m=t[12],y=t[13],w=t[14],b=t[15],v=e[0],A=e[1],x=e[2],T=e[3],E=e[4],C=e[5],M=e[6],I=e[7],S=e[8],L=e[9],R=e[10],k=e[11],P=e[12],z=e[13],U=e[14],D=e[15];return n[0]=r*v+a*A+f*x+m*T,n[1]=i*v+l*A+d*x+y*T,n[2]=s*v+u*A+p*x+w*T,n[3]=o*v+h*A+g*x+b*T,n[4]=r*E+a*C+f*M+m*I,n[5]=i*E+l*C+d*M+y*I,n[6]=s*E+u*C+p*M+w*I,n[7]=o*E+h*C+g*M+b*I,n[8]=r*S+a*L+f*R+m*k,n[9]=i*S+l*L+d*R+y*k,n[10]=s*S+u*L+p*R+w*k,n[11]=o*S+h*L+g*R+b*k,n[12]=r*P+a*z+f*U+m*D,n[13]=i*P+l*z+d*U+y*D,n[14]=s*P+u*z+p*U+w*D,n[15]=o*P+h*z+g*U+b*D,n},negate:function(t,e){return(e=e||new c(16))[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=-t[7],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e[11]=-t[11],e[12]=-t[12],e[13]=-t[13],e[14]=-t[14],e[15]=-t[15],e},ortho:function(t,e,n,r,i,s,o){return(o=o||new c(16))[0]=2/(e-t),o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/(r-n),o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2/(i-s),o[11]=0,o[12]=(e+t)/(t-e),o[13]=(r+n)/(n-r),o[14]=(s+i)/(i-s),o[15]=1,o},perspective:function(t,e,n,r,i){i=i||new c(16);const s=Math.tan(.5*Math.PI-.5*t),o=1/(n-r);return i[0]=s/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=(n+r)*o,i[11]=-1,i[12]=0,i[13]=0,i[14]=n*r*o*2,i[15]=0,i},rotateX:function(t,e,n){n=n||new c(16);const r=t[4],i=t[5],s=t[6],o=t[7],a=t[8],l=t[9],u=t[10],h=t[11],f=Math.cos(e),d=Math.sin(e);return n[4]=f*r+d*a,n[5]=f*i+d*l,n[6]=f*s+d*u,n[7]=f*o+d*h,n[8]=f*a-d*r,n[9]=f*l-d*i,n[10]=f*u-d*s,n[11]=f*h-d*o,t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},rotateY:function(t,e,n){n=n||new c(16);const r=t[0],i=t[1],s=t[2],o=t[3],a=t[8],l=t[9],u=t[10],h=t[11],f=Math.cos(e),d=Math.sin(e);return n[0]=f*r-d*a,n[1]=f*i-d*l,n[2]=f*s-d*u,n[3]=f*o-d*h,n[8]=f*a+d*r,n[9]=f*l+d*i,n[10]=f*u+d*s,n[11]=f*h+d*o,t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},rotateZ:function(t,e,n){n=n||new c(16);const r=t[0],i=t[1],s=t[2],o=t[3],a=t[4],l=t[5],u=t[6],h=t[7],f=Math.cos(e),d=Math.sin(e);return n[0]=f*r+d*a,n[1]=f*i+d*l,n[2]=f*s+d*u,n[3]=f*o+d*h,n[4]=f*a-d*r,n[5]=f*l-d*i,n[6]=f*u-d*s,n[7]=f*h-d*o,t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},rotationX:function(t,e){e=e||new c(16);const n=Math.cos(t),r=Math.sin(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},rotationY:function(t,e){e=e||new c(16);const n=Math.cos(t),r=Math.sin(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},rotationZ:function(t,e){e=e||new c(16);const n=Math.cos(t),r=Math.sin(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},scale:function(t,e,n){n=n||new c(16);const r=e[0],i=e[1],s=e[2];return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=r*t[3],n[4]=i*t[4],n[5]=i*t[5],n[6]=i*t[6],n[7]=i*t[7],n[8]=s*t[8],n[9]=s*t[9],n[10]=s*t[10],n[11]=s*t[11],t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n},scaling:function(t,e){return(e=e||new c(16))[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},setAxis:function(t,e,n,r){r!==t&&(r=u(t,r));const i=4*n;return r[i+0]=e[0],r[i+1]=e[1],r[i+2]=e[2],r},setDefaultType:function(t){const e=c;return c=t,e},setTranslation:function(t,e,n){return t!==(n=n||h())&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11]),n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n},transformDirection:p,transformNormal:function(t,e,r){r=r||n();const i=f(t),s=e[0],o=e[1],a=e[2];return r[0]=s*i[0]+o*i[1]+a*i[2],r[1]=s*i[4]+o*i[5]+a*i[6],r[2]=s*i[8]+o*i[9]+a*i[10],r},transformPoint:d,translate:function(t,e,n){n=n||new c(16);const r=e[0],i=e[1],s=e[2],o=t[0],a=t[1],l=t[2],u=t[3],h=t[4],f=t[5],d=t[6],p=t[7],g=t[8],m=t[9],y=t[10],w=t[11],b=t[12],v=t[13],A=t[14],x=t[15];return t!==n&&(n[0]=o,n[1]=a,n[2]=l,n[3]=u,n[4]=h,n[5]=f,n[6]=d,n[7]=p,n[8]=g,n[9]=m,n[10]=y,n[11]=w),n[12]=o*r+h*i+g*s+b,n[13]=a*r+f*i+m*s+v,n[14]=l*r+d*i+y*s+A,n[15]=u*r+p*i+w*s+x,n},translation:function(t,e){return(e=e||new c(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},transpose:function(t,e){if((e=e||new c(16))===t){let n;return n=t[1],t[1]=t[4],t[4]=n,n=t[2],t[2]=t[8],t[8]=n,n=t[3],t[3]=t[12],t[12]=n,n=t[6],t[6]=t[9],t[9]=n,n=t[7],t[7]=t[13],t[13]=n,n=t[11],t[11]=t[14],t[14]=n,e}const n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],l=t[6],u=t[7],h=t[8],f=t[9],d=t[10],p=t[11],g=t[12],m=t[13],y=t[14],w=t[15];return e[0]=n,e[1]=o,e[2]=h,e[3]=g,e[4]=r,e[5]=a,e[6]=f,e[7]=m,e[8]=i,e[9]=l,e[10]=d,e[11]=y,e[12]=s,e[13]=u,e[14]=p,e[15]=w,e}});const m=5120,y=5121,w=5124;{const t={};t[m]=Int8Array,t[5121]=Uint8Array,t[5122]=Int16Array,t[5123]=Uint16Array,t[w]=Int32Array,t[5125]=Uint32Array,t[5126]=Float32Array,t[32819]=Uint16Array,t[32820]=Uint16Array,t[33635]=Uint16Array,t[5131]=Uint16Array,t[33640]=Uint32Array,t[35899]=Uint32Array,t[35902]=Uint32Array,t[36269]=Uint32Array,t[34042]=Uint32Array}function b(t){if(t instanceof Int8Array)return m;if(t instanceof Uint8Array)return y;if(t instanceof Uint8ClampedArray)return y;if(t instanceof Int16Array)return 5122;if(t instanceof Uint16Array)return 5123;if(t instanceof Int32Array)return w;if(t instanceof Uint32Array)return 5125;if(t instanceof Float32Array)return 5126;throw new Error("unsupported typed array type")}const v="undefined"!=typeof SharedArrayBuffer?function(t){return t&&t.buffer&&(t.buffer instanceof ArrayBuffer||t.buffer instanceof SharedArrayBuffer)}:function(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer};function A(t,e){return"undefined"!=typeof WebGLTexture&&e instanceof WebGLTexture}const x=34962,T="";function E(t,e,n,r){if("undefined"!=typeof WebGLBuffer&&e instanceof WebGLBuffer)return e;n=n||x;const i=t.createBuffer();return function(t,e,n,r,i){t.bindBuffer(e,n),t.bufferData(e,r,i||35044)}(t,n,i,e,r),i}function C(t){return"indices"===t}function M(t){return t.length?t:t.data}const I=/coord|texture/i,S=/color|colour/i;function L(t,e){let n;if(n=I.test(t)?2:S.test(t)?4:3,e%n>0)throw new Error(`Can not guess numComponents for attribute '${t}'. Tried ${n} but ${e} values is not evenly divisible by ${n}. You should specify it.`);return n}function R(t,e){return t.numComponents||t.size||L(e,M(t).length)}function k(t,e){if(v(t))return t;if(v(t.data))return t.data;Array.isArray(t)&&(t={data:t});let n=t.type;return n||(n=C(e)?Uint16Array:Float32Array),new n(t.data)}function P(t,e){const n={};return Object.keys(e).forEach((function(r){if(!C(r)){const s=e[r],o=s.attrib||s.name||s.attribName||T+r;if(s.value){if(!Array.isArray(s.value)&&!v(s.value))throw new Error("array.value is not array or typedarray");n[o]={value:s.value}}else{let e,a,l,c;if(s.buffer&&s.buffer instanceof WebGLBuffer)e=s.buffer,c=s.numComponents||s.size,a=s.type,l=s.normalize;else if("number"==typeof s||"number"==typeof s.data){const n=s.data||s,o=s.type||Float32Array,u=n*o.BYTES_PER_ELEMENT;a=function(t){if(t===Int8Array)return m;if(t===Uint8Array)return y;if(t===Uint8ClampedArray)return y;if(t===Int16Array)return 5122;if(t===Uint16Array)return 5123;if(t===Int32Array)return w;if(t===Uint32Array)return 5125;if(t===Float32Array)return 5126;throw new Error("unsupported typed array type")}(o),l=void 0!==s.normalize?s.normalize:(i=o)===Int8Array||i===Uint8Array,c=s.numComponents||s.size||L(r,n),e=t.createBuffer(),t.bindBuffer(x,e),t.bufferData(x,u,s.drawType||35044)}else{const n=k(s,r);e=E(t,n,void 0,s.drawType),a=b(n),l=void 0!==s.normalize?s.normalize:function(t){return t instanceof Int8Array||t instanceof Uint8Array}(n),c=R(s,r)}n[o]={buffer:e,numComponents:c,type:a,normalize:l,stride:s.stride||0,offset:s.offset||0,divisor:void 0===s.divisor?void 0:s.divisor,drawType:s.drawType}}}var i})),t.bindBuffer(x,null),n}const z=["position","positions","a_position"];function U(t,e,n){const r=P(t,e),i=Object.assign({},n||{});i.attribs=Object.assign({},n?n.attribs:{},r);const s=e.indices;if(s){const e=k(s,"indices");i.indices=E(t,e,34963),i.numElements=e.length,i.elementType=b(e)}else i.numElements||(i.numElements=function(t,e){let n,r;for(r=0;r<z.length&&(n=z[r],!(n in e))&&(n=T+n,!(n in e));++r);r===z.length&&(n=Object.keys(e)[0]);const i=e[n];if(!i.buffer)return 1;t.bindBuffer(x,i.buffer);const s=t.getBufferParameter(x,34660);var o;t.bindBuffer(x,null);const a=s/(5120===(o=i.type)||5121===o?1:5122===o||5123===o?2:5124===o||5125===o||5126===o?4:0),l=i.numComponents||i.size,c=a/l;if(c%1!=0)throw new Error(`numComponents ${l} not correct for length ${length}`);return c}(t,i.attribs));return i}function D(t,e){const n={};return Object.keys(e).forEach((function(r){n[r]=function(t,e,n){const r="indices"===n?34963:x;return E(t,k(e,n),r)}(t,e[r],r)})),e.indices?(n.numElements=e.indices.length,n.elementType=b(k(e.indices))):n.numElements=function(t){let e,n;for(n=0;n<z.length&&(e=z[n],!(e in t));++n);n===z.length&&(e=Object.keys(t)[0]);const r=t[e],i=M(r).length;if(void 0===i)return 1;const s=R(r,e),o=i/s;if(i%s>0)throw new Error(`numComponents ${s} not correct for length ${i}`);return o}(e),n}function B(t,e,n){return function(t,e){let n=0;return t.push=function(){for(let e=0;e<arguments.length;++e){const r=arguments[e];if(r instanceof Array||v(r))for(let e=0;e<r.length;++e)t[n++]=r[e];else t[n++]=r}},t.reset=function(t){n=t||0},t.numComponents=e,Object.defineProperty(t,"numElements",{get:function(){return this.length/this.numComponents|0}}),t}(new(n||Float32Array)(t*e),t)}function _(t,e,n){const r=t.length,i=new Float32Array(3);for(let s=0;s<r;s+=3)n(e,[t[s],t[s+1],t[s+2]],i),t[s]=i[0],t[s+1]=i[1],t[s+2]=i[2]}function F(t,e,r){r=r||n();const i=e[0],s=e[1],o=e[2];return r[0]=i*t[0]+s*t[1]+o*t[2],r[1]=i*t[4]+s*t[5]+o*t[6],r[2]=i*t[8]+s*t[9]+o*t[10],r}function O(t,e){return Object.keys(t).forEach((function(n){const r=t[n];n.indexOf("pos")>=0?function(t,e){_(t,e,d)}(r,e):n.indexOf("tan")>=0||n.indexOf("binorm")>=0?function(t,e){_(t,e,p)}(r,e):n.indexOf("norm")>=0&&function(t,e){_(t,f(e),F)}(r,e)})),t}function X(t,e,n){return t=t||2,{position:{numComponents:2,data:[(e=e||0)+-1*(t*=.5),(n=n||0)+-1*t,e+1*t,n+-1*t,e+-1*t,n+1*t,e+1*t,n+1*t]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function $(t,e,n,r,i){t=t||1,e=e||1,n=n||1,r=r||1,i=i||h();const s=(n+1)*(r+1),o=B(3,s),a=B(3,s),l=B(2,s);for(let i=0;i<=r;i++)for(let s=0;s<=n;s++){const c=s/n,u=i/r;o.push(t*c-.5*t,0,e*u-.5*e),a.push(0,1,0),l.push(c,u)}const c=n+1,u=B(3,n*r*2,Uint16Array);for(let t=0;t<r;t++)for(let e=0;e<n;e++)u.push((t+0)*c+e,(t+1)*c+e,(t+0)*c+e+1),u.push((t+1)*c+e,(t+1)*c+e+1,(t+0)*c+e+1);return O({position:o,normal:a,texcoord:l,indices:u},i)}function V(t,e,n,r,i,s,o){if(e<=0||n<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");r=r||0,s=s||0;const a=(i=i||Math.PI)-r,l=(o=o||2*Math.PI)-s,c=(e+1)*(n+1),u=B(3,c),h=B(3,c),f=B(2,c);for(let i=0;i<=n;i++)for(let o=0;o<=e;o++){const c=o/e,d=i/n,p=l*c+s,g=a*d+r,m=Math.sin(p),y=Math.cos(p),w=Math.sin(g),b=y*w,v=Math.cos(g),A=m*w;u.push(t*b,t*v,t*A),h.push(b,v,A),f.push(1-c,d)}const d=e+1,p=B(3,e*n*2,Uint16Array);for(let t=0;t<e;t++)for(let e=0;e<n;e++)p.push((e+0)*d+t,(e+0)*d+t+1,(e+1)*d+t),p.push((e+1)*d+t,(e+0)*d+t+1,(e+1)*d+t+1);return{position:u,normal:h,texcoord:f,indices:p}}const Y=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function G(t){const e=(t=t||1)/2,n=[[-e,-e,-e],[+e,-e,-e],[-e,+e,-e],[+e,+e,-e],[-e,-e,+e],[+e,-e,+e],[-e,+e,+e],[+e,+e,+e]],r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],i=[[1,0],[0,0],[0,1],[1,1]],s=B(3,24),o=B(3,24),a=B(2,24),l=B(3,12,Uint16Array);for(let t=0;t<6;++t){const e=Y[t];for(let l=0;l<4;++l){const c=n[e[l]],u=r[t],h=i[l];s.push(c),o.push(u),a.push(h)}const c=4*t;l.push(c+0,c+1,c+2),l.push(c+0,c+2,c+3)}return{position:s,normal:o,texcoord:a,indices:l}}function N(t,e,n,r,i,s,o){if(r<3)throw new Error("radialSubdivisions must be 3 or greater");if(i<1)throw new Error("verticalSubdivisions must be 1 or greater");const a=void 0===s||s,l=void 0===o||o,c=(a?2:0)+(l?2:0),u=(r+1)*(i+1+c),h=B(3,u),f=B(3,u),d=B(2,u),p=B(3,r*(i+c/2)*2,Uint16Array),g=r+1,m=Math.atan2(t-e,n),y=Math.cos(m),w=Math.sin(m),b=i+(l?2:0);for(let s=a?-2:0;s<=b;++s){let o,a=s/i,l=n*a;s<0?(l=0,a=1,o=t):s>i?(l=n,a=1,o=e):o=t+s/i*(e-t),-2!==s&&s!==i+2||(o=0,a=0),l-=n/2;for(let t=0;t<g;++t){const e=Math.sin(t*Math.PI*2/r),n=Math.cos(t*Math.PI*2/r);h.push(e*o,l,n*o),s<0?f.push(0,-1,0):s>i?f.push(0,1,0):0===o?f.push(0,0,0):f.push(e*y,w,n*y),d.push(t/r,1-a)}}for(let t=0;t<i+c;++t)if(!(1===t&&a||t===i+c-2&&l))for(let e=0;e<r;++e)p.push(g*(t+0)+0+e,g*(t+0)+1+e,g*(t+1)+1+e),p.push(g*(t+0)+0+e,g*(t+1)+1+e,g*(t+1)+0+e);return{position:h,normal:f,texcoord:d,indices:p}}function W(t,e){e=e||[];const n=[];for(let r=0;r<t.length;r+=4){const i=t[r],s=t.slice(r+1,r+4);s.push.apply(s,e);for(let t=0;t<i;++t)n.push.apply(n,s)}return n}function j(){const t=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],e=W([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),n=W([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),r=t.length/3,i={position:B(3,r),texcoord:B(2,r),normal:B(3,r),color:B(4,r,Uint8Array),indices:B(3,r/3,Uint16Array)};i.position.push(t),i.texcoord.push([.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0]),i.normal.push(e),i.color.push(n);for(let t=0;t<r;++t)i.indices.push(t);return i}function H(t,n,i,s,o,a,l){if(o<=0)throw new Error("subdivisionDown must be > 0");const c=(l=l||1)-(a=a||0),u=2*(o+1)*4,h=B(3,u),f=B(3,u),d=B(2,u);function p(t,e,n){return t+(e-t)*n}function g(n,i,l,u,g,m){for(let v=0;v<=o;v++){const A=i/1,x=v/o,T=2*(A-.5),E=(a+x*c)*Math.PI,C=Math.sin(E),M=Math.cos(E),I=p(t,n,C),S=T*s,L=M*t,R=C*I;h.push(S,L,R);const k=r((y=[0,C,M],w=l,(b=(b=void 0)||new e(3))[0]=y[0]*w[0],b[1]=y[1]*w[1],b[2]=y[2]*w[2],b),u);f.push(k),d.push(A*g+m,x)}var y,w,b}for(let t=0;t<2;t++){const e=2*(t/1-.5);g(n,t,[1,1,1],[0,0,0],1,0),g(n,t,[0,0,0],[e,0,0],0,0),g(i,t,[1,1,1],[0,0,0],1,0),g(i,t,[0,0,0],[e,0,0],0,1)}const m=B(3,2*o*4,Uint16Array);function y(t,e){for(let n=0;n<o;++n)m.push(t+n+0,t+n+1,e+n+0),m.push(t+n+1,e+n+1,e+n+0)}const w=o+1;return y(0*w,4*w),y(5*w,7*w),y(6*w,2*w),y(3*w,1*w),{position:h,normal:f,texcoord:d,indices:m}}function q(t,e,n,r,i,s){return N(t,t,e,n,r,i,s)}function Z(t,e,n,r,i,s){if(n<3)throw new Error("radialSubdivisions must be 3 or greater");if(r<3)throw new Error("verticalSubdivisions must be 3 or greater");i=i||0;const o=(s=s||2*Math.PI)-i,a=n+1,l=r+1,c=a*l,u=B(3,c),h=B(3,c),f=B(2,c),d=B(3,n*r*2,Uint16Array);for(let s=0;s<l;++s){const l=s/r,c=l*Math.PI*2,d=Math.sin(c),p=t+d*e,g=Math.cos(c),m=g*e;for(let t=0;t<a;++t){const e=t/n,r=i+e*o,s=Math.sin(r),a=Math.cos(r),c=s*p,y=a*p,w=s*d,b=a*d;u.push(c,m,y),h.push(w,g,b),f.push(e,1-l)}}for(let t=0;t<r;++t)for(let e=0;e<n;++e){const n=1+e,r=1+t;d.push(a*t+e,a*r+e,a*t+n),d.push(a*r+e,a*r+n,a*t+n)}return{position:u,normal:h,texcoord:f,indices:d}}function K(t,e,n,r,i){if(e<3)throw new Error("divisions must be at least 3");i=i||1,r=r||0;const s=(e+1)*((n=n||1)+1),o=B(3,s),a=B(3,s),l=B(2,s),c=B(3,n*e*2,Uint16Array);let u=0;const h=t-r,f=e+1;for(let t=0;t<=n;++t){const s=r+h*Math.pow(t/n,i);for(let r=0;r<=e;++r){const i=2*Math.PI*r/e,h=s*Math.cos(i),d=s*Math.sin(i);if(o.push(h,0,d),a.push(0,1,0),l.push(1-r/e,t/n),t>0&&r!==e){const t=u+(r+1),e=u+r,n=u+r-f,i=u+(r+1)-f;c.push(t,e,n),c.push(t,n,i)}}u+=e+1}return{position:o,normal:a,texcoord:l,indices:c}}function J(t){return function(e){const n=t.apply(this,Array.prototype.slice.call(arguments,1));return D(e,n)}}function Q(t){return function(e){const n=t.apply(null,Array.prototype.slice.call(arguments,1));return U(e,n)}}function tt(t){return!!t.texStorage2D}Q(j),J(j),Q(G),J(G),Q($),J($),Q(V),J(V),Q(N),J(N),Q(X),J(X),Q(H),J(H),Q(q),J(q),Q(Z),J(Z),Q(K),J(K);const et=function(){const t={},e={};return function(n,r){return function(n){const r=n.constructor.name;if(!t[r]){for(const t in n)if("number"==typeof n[t]){const r=e[n[t]];e[n[t]]=r?`${r} | ${t}`:t}t[r]=!0}}(n),e[r]||("number"==typeof r?`0x${r.toString(16)}`:r)}}();new Uint8Array([128,192,255,255]);{const t={};t[6406]={numColorComponents:1},t[6409]={numColorComponents:1},t[6410]={numColorComponents:2},t[6407]={numColorComponents:3},t[6408]={numColorComponents:4},t[6403]={numColorComponents:1},t[36244]={numColorComponents:1},t[33319]={numColorComponents:2},t[33320]={numColorComponents:2},t[6407]={numColorComponents:3},t[36248]={numColorComponents:3},t[6408]={numColorComponents:4},t[36249]={numColorComponents:4},t[6402]={numColorComponents:1},t[34041]={numColorComponents:2}}const nt=function(...t){console.error(...t)};function rt(t){return"undefined"!=typeof document&&document.getElementById?document.getElementById(t):null}const it=33984,st=34962,ot=3553,at=34067,lt=32879,ct=35866,ut={};function ht(t,e){return ut[e].bindPoint}function ft(t,e){return function(n){t.uniform1i(e,n)}}function dt(t,e){return function(n){t.uniform1iv(e,n)}}function pt(t,e){return function(n){t.uniform2iv(e,n)}}function gt(t,e){return function(n){t.uniform3iv(e,n)}}function mt(t,e){return function(n){t.uniform4iv(e,n)}}function yt(t,e,n,r){const i=ht(0,e);return tt(t)?function(e){let s,o;A(0,e)?(s=e,o=null):(s=e.texture,o=e.sampler),t.uniform1i(r,n),t.activeTexture(it+n),t.bindTexture(i,s),t.bindSampler(n,o)}:function(e){t.uniform1i(r,n),t.activeTexture(it+n),t.bindTexture(i,e)}}function wt(t,e,n,r,i){const s=ht(0,e),o=new Int32Array(i);for(let t=0;t<i;++t)o[t]=n+t;return tt(t)?function(e){t.uniform1iv(r,o),e.forEach((function(e,r){let i,a;t.activeTexture(it+o[r]),A(0,e)?(i=e,a=null):(i=e.texture,a=e.sampler),t.bindSampler(n,a),t.bindTexture(s,i)}))}:function(e){t.uniform1iv(r,o),e.forEach((function(e,n){t.activeTexture(it+o[n]),t.bindTexture(s,e)}))}}function bt(t,e){return function(n){if(n.value)switch(t.disableVertexAttribArray(e),n.value.length){case 4:t.vertexAttrib4fv(e,n.value);break;case 3:t.vertexAttrib3fv(e,n.value);break;case 2:t.vertexAttrib2fv(e,n.value);break;case 1:t.vertexAttrib1fv(e,n.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else t.bindBuffer(st,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,n.numComponents||n.size,n.type||5126,n.normalize||!1,n.stride||0,n.offset||0),void 0!==n.divisor&&t.vertexAttribDivisor(e,n.divisor)}}function vt(t,e){return function(n){if(n.value){if(t.disableVertexAttribArray(e),4!==n.value.length)throw new Error("The length of an integer constant value must be 4!");t.vertexAttrib4iv(e,n.value)}else t.bindBuffer(st,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,n.numComponents||n.size,n.type||5124,n.stride||0,n.offset||0),void 0!==n.divisor&&t.vertexAttribDivisor(e,n.divisor)}}function At(t,e){return function(n){if(n.value){if(t.disableVertexAttribArray(e),4!==n.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");t.vertexAttrib4uiv(e,n.value)}else t.bindBuffer(st,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,n.numComponents||n.size,n.type||5125,n.stride||0,n.offset||0),void 0!==n.divisor&&t.vertexAttribDivisor(e,n.divisor)}}function xt(t,e,n){const r=n.size,i=n.count;return function(n){t.bindBuffer(st,n.buffer);const s=n.size||n.numComponents||r,o=s/i,a=n.type||5126,l=ut[a].size*s,c=n.normalize||!1,u=n.offset||0,h=l/i;for(let r=0;r<i;++r)t.enableVertexAttribArray(e+r),t.vertexAttribPointer(e+r,o,a,c,l,u+h*r),void 0!==n.divisor&&t.vertexAttribDivisor(e+r,n.divisor)}}ut[5126]={Type:Float32Array,size:4,setter:function(t,e){return function(n){t.uniform1f(e,n)}},arraySetter:function(t,e){return function(n){t.uniform1fv(e,n)}}},ut[35664]={Type:Float32Array,size:8,setter:function(t,e){return function(n){t.uniform2fv(e,n)}},cols:2},ut[35665]={Type:Float32Array,size:12,setter:function(t,e){return function(n){t.uniform3fv(e,n)}},cols:3},ut[35666]={Type:Float32Array,size:16,setter:function(t,e){return function(n){t.uniform4fv(e,n)}},cols:4},ut[5124]={Type:Int32Array,size:4,setter:ft,arraySetter:dt},ut[35667]={Type:Int32Array,size:8,setter:pt,cols:2},ut[35668]={Type:Int32Array,size:12,setter:gt,cols:3},ut[35669]={Type:Int32Array,size:16,setter:mt,cols:4},ut[5125]={Type:Uint32Array,size:4,setter:function(t,e){return function(n){t.uniform1ui(e,n)}},arraySetter:function(t,e){return function(n){t.uniform1uiv(e,n)}}},ut[36294]={Type:Uint32Array,size:8,setter:function(t,e){return function(n){t.uniform2uiv(e,n)}},cols:2},ut[36295]={Type:Uint32Array,size:12,setter:function(t,e){return function(n){t.uniform3uiv(e,n)}},cols:3},ut[36296]={Type:Uint32Array,size:16,setter:function(t,e){return function(n){t.uniform4uiv(e,n)}},cols:4},ut[35670]={Type:Uint32Array,size:4,setter:ft,arraySetter:dt},ut[35671]={Type:Uint32Array,size:8,setter:pt,cols:2},ut[35672]={Type:Uint32Array,size:12,setter:gt,cols:3},ut[35673]={Type:Uint32Array,size:16,setter:mt,cols:4},ut[35674]={Type:Float32Array,size:32,setter:function(t,e){return function(n){t.uniformMatrix2fv(e,!1,n)}},rows:2,cols:2},ut[35675]={Type:Float32Array,size:48,setter:function(t,e){return function(n){t.uniformMatrix3fv(e,!1,n)}},rows:3,cols:3},ut[35676]={Type:Float32Array,size:64,setter:function(t,e){return function(n){t.uniformMatrix4fv(e,!1,n)}},rows:4,cols:4},ut[35685]={Type:Float32Array,size:32,setter:function(t,e){return function(n){t.uniformMatrix2x3fv(e,!1,n)}},rows:2,cols:3},ut[35686]={Type:Float32Array,size:32,setter:function(t,e){return function(n){t.uniformMatrix2x4fv(e,!1,n)}},rows:2,cols:4},ut[35687]={Type:Float32Array,size:48,setter:function(t,e){return function(n){t.uniformMatrix3x2fv(e,!1,n)}},rows:3,cols:2},ut[35688]={Type:Float32Array,size:48,setter:function(t,e){return function(n){t.uniformMatrix3x4fv(e,!1,n)}},rows:3,cols:4},ut[35689]={Type:Float32Array,size:64,setter:function(t,e){return function(n){t.uniformMatrix4x2fv(e,!1,n)}},rows:4,cols:2},ut[35690]={Type:Float32Array,size:64,setter:function(t,e){return function(n){t.uniformMatrix4x3fv(e,!1,n)}},rows:4,cols:3},ut[35678]={Type:null,size:0,setter:yt,arraySetter:wt,bindPoint:ot},ut[35680]={Type:null,size:0,setter:yt,arraySetter:wt,bindPoint:at},ut[35679]={Type:null,size:0,setter:yt,arraySetter:wt,bindPoint:lt},ut[35682]={Type:null,size:0,setter:yt,arraySetter:wt,bindPoint:ot},ut[36289]={Type:null,size:0,setter:yt,arraySetter:wt,bindPoint:ct},ut[36292]={Type:null,size:0,setter:yt,arraySetter:wt,bindPoint:ct},ut[36293]={Type:null,size:0,setter:yt,arraySetter:wt,bindPoint:at},ut[36298]={Type:null,size:0,setter:yt,arraySetter:wt,bindPoint:ot},ut[36299]={Type:null,size:0,setter:yt,arraySetter:wt,bindPoint:lt},ut[36300]={Type:null,size:0,setter:yt,arraySetter:wt,bindPoint:at},ut[36303]={Type:null,size:0,setter:yt,arraySetter:wt,bindPoint:ct},ut[36306]={Type:null,size:0,setter:yt,arraySetter:wt,bindPoint:ot},ut[36307]={Type:null,size:0,setter:yt,arraySetter:wt,bindPoint:lt},ut[36308]={Type:null,size:0,setter:yt,arraySetter:wt,bindPoint:at},ut[36311]={Type:null,size:0,setter:yt,arraySetter:wt,bindPoint:ct};const Tt={};Tt[5126]={size:4,setter:bt},Tt[35664]={size:8,setter:bt},Tt[35665]={size:12,setter:bt},Tt[35666]={size:16,setter:bt},Tt[5124]={size:4,setter:vt},Tt[35667]={size:8,setter:vt},Tt[35668]={size:12,setter:vt},Tt[35669]={size:16,setter:vt},Tt[5125]={size:4,setter:At},Tt[36294]={size:8,setter:At},Tt[36295]={size:12,setter:At},Tt[36296]={size:16,setter:At},Tt[35670]={size:4,setter:vt},Tt[35671]={size:8,setter:vt},Tt[35672]={size:12,setter:vt},Tt[35673]={size:16,setter:vt},Tt[35674]={size:4,setter:xt,count:2},Tt[35675]={size:9,setter:xt,count:3},Tt[35676]={size:16,setter:xt,count:4};const Et=/ERROR:\s*\d+:(\d+)/gi,Ct=/^[ \t]*\n/;function Mt(t){let e=0;return Ct.test(t)&&(e=1,t=t.replace(Ct,"")),{lineOffset:e,shaderSource:t}}function It(t,e){return t.errorCallback(e),t.callback&&setTimeout((()=>{t.callback(`${e}\n${t.errors.join("\n")}`)})),null}function St(t,e,n,r){const i=t.createShader(n);return t.shaderSource(i,Mt(e).shaderSource),t.compileShader(i),r.callback||function(t,e,n,r){r=r||nt;const i=t.getShaderParameter(n,35713);if(!i){const i=t.getShaderInfoLog(n),{lineOffset:s,shaderSource:o}=Mt(t.getShaderSource(n));r(`${function(t,e="",n=0){const r=[...e.matchAll(Et)],i=new Map(r.map(((t,n)=>{const i=parseInt(t[1]),s=r[n+1],o=s?s.index:e.length;return[i-1,e.substring(t.index,o)]})));return t.split("\n").map(((t,e)=>{const r=i.get(e);return`${e+1+n}: ${t}${r?`\n\n^^^ ${r}`:""}`})).join("\n")}(o,i,s)}\nError compiling ${et(t,e)}: ${i}`)}return i}(t,n,i,r.errorCallback)?i:(t.deleteShader(i),null)}function Lt(t,e,n){let r,i,s;if("function"==typeof e&&(n=e,e=void 0),"function"==typeof t)n=t,t=void 0;else if(t&&!Array.isArray(t)){if(t.errorCallback&&t.errors)return t;const e=t;n=e.errorCallback,t=e.attribLocations,r=e.transformFeedbackVaryings,i=e.transformFeedbackMode,s=e.callback}const o=n||nt,a=[],l={errorCallback(t,...e){a.push(t),o(t,...e)},transformFeedbackVaryings:r,transformFeedbackMode:i,callback:s,errors:a};if(t){let n={};Array.isArray(t)?t.forEach((function(t,r){n[t]=e?e[r]:r})):n=t,l.attribLocations=n}return l}const Rt=["VERTEX_SHADER","FRAGMENT_SHADER"];function kt(t,e){return e.indexOf("frag")>=0?35632:e.indexOf("vert")>=0?35633:void 0}function Pt(t,e){e.forEach((function(e){t.deleteShader(e)}))}const zt=(t=0)=>new Promise((e=>setTimeout(e,t)));function Ut(t,e,n){n=n||nt;const r=t.getProgramParameter(e,35714);return r||n(`Error in program linking: ${t.getProgramInfoLog(e)}`),r}function Dt(t,e,n,r){let i="";const s=rt(e);if(!s)return It(r,`unknown script element: ${e}`);i=s.text;const o=n||kt(0,s.type);return o?St(t,i,o,r):It(r,"unknown shader type")}function Bt(t,e,n,r,i){const s=Lt(n,r,i),o=[];for(let n=0;n<e.length;++n){const r=Dt(t,e[n],t[Rt[n]],s);if(!r)return null;o.push(r)}return function(t,e,n,r,i){const s=Lt(n,r,i),o=[],a=[];for(let n=0;n<e.length;++n){let r=e[n];if("string"==typeof r){const e=rt(r),i=e?e.text:r;let o=t[Rt[n]];e&&e.type&&(o=kt(0,e.type)||o),r=St(t,i,o,s),a.push(r)}"undefined"!=typeof WebGLShader&&r instanceof WebGLShader&&o.push(r)}if(o.length!==e.length)return Pt(t,a),It(s,"not enough shaders for program");const l=t.createProgram();o.forEach((function(e){t.attachShader(l,e)})),s.attribLocations&&Object.keys(s.attribLocations).forEach((function(e){t.bindAttribLocation(l,s.attribLocations[e],e)}));let c=s.transformFeedbackVaryings;return c&&(c.attribs&&(c=c.attribs),Array.isArray(c)||(c=Object.keys(c)),t.transformFeedbackVaryings(l,c,s.transformFeedbackMode||35981)),t.linkProgram(l),s.callback?(async function(t,e,n){const r=t.getExtension("KHR_parallel_shader_compile"),i=r?(t,e)=>t.getProgramParameter(e,r.COMPLETION_STATUS_KHR):()=>!0;let s=0;do{await zt(s),s=1e3/60}while(!i(t,e));const o=Ut(t,e,n.errorCallback),a=o?void 0:n.errors.join("\n");o||((n.errorCallback||nt)(a),t.deleteProgram(e),e=null),n.callback(a,e)}(t,l,s),null):Ut(t,l,s.errorCallback)?l:(t.deleteProgram(l),Pt(t,a),null)}(t,o,s)}const _t=36096,Ft=33306,Ot={};Ot[34041]=Ft,Ot[6401]=36128,Ot[36168]=36128,Ot[6402]=_t,Ot[33189]=_t,Ot[33190]=_t,Ot[36012]=_t,Ot[35056]=Ft,Ot[36013]=Ft;var Xt=0;const $t={menu:"./assets/title.png",tutorial1:"./assets/tutorial1.png",tutorial2:"./assets/tutorial2.png",red:"./assets/red.png",blue:"./assets/blue.png",green:"./assets/green.png",gray:"./assets/gray.png",shield:"./assets/shield.png",arrowUp:"./assets/arrowlighter-up.png",arrowDown:"./assets/arrowlighter-down.png",arrowRight:"./assets/arrowlighter-right.png",arrowLeft:"./assets/arrowlighter-left.png",diceIcon:"./assets/dice.png",glyph1:"./assets/thicdiceface1.png",glyph2:"./assets/thicdiceface4.png",glyph3:"./assets/thicdiceface2.png",onebanana:"./assets/onebanana.png",threebanana:"./assets/threebanana.png",splitbanana:"./assets/splitbanana.png",background:"./assets/background.png",credits:"./assets/credits.png",check:"./assets/check.png",dead:"./assets/monkeyface-dead.png",happy:"./assets/monkeyface-happyeyebrow.png",neutral:"./assets/monkeyface-happy.png"},Vt={clunk1:"./assets/clunk.mp3",clunk2:"./assets/clunk.mp3",clunk3:"./assets/clunk.mp3",clunk4:"./assets/clunk.mp3",blip:"./assets/blip.mp3",shoop:"./assets/shoop.mp3",win:"./assets/win.mp3"},Yt={},Gt={},Nt=()=>{Xt++},Wt=[{x:0,y:Math.PI/-2},{x:0,y:Math.PI/2},{x:Math.PI/2,y:0},{x:Math.PI/-2,y:0},{x:0,y:0},{x:0,y:Math.PI}];let jt=[];for(let t=0;t<16;t++)if(jt.push(document.createElement("canvas").getContext("webgl")),!jt[0].drawingBufferHeight){jt.shift();break}console.log("webgl renderers:",jt.length),jt.forEach((t=>{t.canvas.height=100,t.canvas.width=100,document.body.appendChild(t.canvas),t.canvas.classList.add("gone")})),jt[0]||console.error("no webgl :(");let Ht=jt.map((t=>null)),qt=0;class Zt{constructor(t,e){var n,r;this.face="",this.color="",this.faceIdx=0,this.faces=t,this.colors=e,this.done=!0,this.canvasCount=qt++%jt.length,this.bufferCtx=document.createElement("canvas").getContext("2d"),this.bufferCtx.canvas.width=100,this.bufferCtx.canvas.height=100,this.gl=jt[this.canvasCount],this.canvas=this.gl.canvas,this.program=Bt(this.gl,["vertex-shader-3d","fragment-shader-3d"]),this.positionLocation=this.gl.getAttribLocation(this.program,"a_position"),this.matrixLocation=this.gl.getUniformLocation(this.program,"u_matrix"),this.textureLocation=this.gl.getUniformLocation(this.program,"u_texture"),this.positionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),n=this.gl,r=new Float32Array([-1,-1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,1,1,-1,1,-1,-1,1,1,1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,1]),n.bufferData(n.ARRAY_BUFFER,r.map((t=>1*t)),n.STATIC_DRAW);var i=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,i),this.mapFaces(t,e),this.fieldOfViewRadians=Kt(1),this.rotX=Kt(0),this.rotY=Kt(0),this.rotXTarget=Math.PI/4+Math.PI/2*Math.floor(3*Math.random()),this.rotYTarget=Math.PI/4+Math.PI/2*Math.floor(3*Math.random()),this.rotXVel=.001,this.rotYVel=.001,this.rollStopTime=0}mapFaces(t,e){this.faces=t,this.colors=e;const n=document.createElement("canvas").getContext("2d");n.canvas.width=128,n.canvas.height=128,[{target:this.gl.TEXTURE_CUBE_MAP_POSITIVE_X,faceColor:e[0],textColor:"#222",text:t[0]},{target:this.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,faceColor:e[1],textColor:"#222",text:t[1]},{target:this.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,faceColor:e[2],textColor:"#222",text:t[2]},{target:this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,faceColor:e[3],textColor:"#222",text:t[3]},{target:this.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,faceColor:e[4],textColor:"#222",text:t[4]},{target:this.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,faceColor:e[5],textColor:"#222",text:t[5]}].forEach((t=>{const{target:e,faceColor:r,textColor:i,text:s}=t;!function(t,e,n,r){let i=Yt[e];const{width:s,height:o}=t.canvas;i?t.drawImage(i,0,0,s,o):(t.fillStyle=e,t.fillRect(0,0,s,o));let a=Yt[r];a?t.drawImage(a,0,0,s,o):(t.font=.7*s+"px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillStyle=n,t.fillText(r,s/2,o/2))}(n,r,i,s);const o=this.gl.RGBA,a=this.gl.RGBA,l=this.gl.UNSIGNED_BYTE;this.gl.texImage2D(e,0,o,a,l,n.canvas)})),this.gl.generateMipmap(this.gl.TEXTURE_CUBE_MAP),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR)}draw(t,e,n,r=!1){r||!this.isDoneRolling(Date.now())?(Ht[this.canvasCount]!==this&&this.mapFaces(this.faces,this.colors),this.drawScene(),this.bufferCtx.clearRect(0,0,100,100),this.bufferCtx.drawImage(this.gl.canvas,0,0),t.drawImage(this.bufferCtx.canvas,e-50,n-50,100,100),Ht[this.canvasCount]=this):t.drawImage(this.bufferCtx.canvas,e-50,n-50,100,100)}drawScene(){let{program:t,positionLocation:e,matrixLocation:n,textureLocation:r}=this,i=performance.now();i*=.001,this.then,this.then=i,this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.enable(this.gl.CULL_FACE),this.gl.enable(this.gl.DEPTH_TEST),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.useProgram(t),this.gl.enableVertexAttribArray(e),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer);var s=this.gl.FLOAT;this.gl.vertexAttribPointer(e,3,s,!1,0,0);var o=this.canvas.clientWidth/this.canvas.clientHeight,a=g.perspective(this.fieldOfViewRadians,o,1,2e3),l=g.lookAt([0,0,200],[0,0,0],[0,1,0]),c=g.inverse(l),u=g.multiply(a,c);this.rotX=Math.max(this.rollStopTime-Date.now(),0)*this.rotXVel+this.rotXTarget,this.rotY=Math.max(this.rollStopTime-Date.now(),0)*this.rotYVel+this.rotYTarget;var h=u;h=g.rotateY(h,this.rotY),h=g.rotateX(h,this.rotX),this.gl.uniformMatrix4fv(n,!1,h),this.gl.uniform1i(r,0),this.gl.drawArrays(this.gl.TRIANGLES,0,36)}roll(t,e,n){this.rotXTarget=Wt[t].x+.5*Math.random()-.25,this.rotYTarget=Wt[t].y+.5*Math.random()-.25,this.rollStopTime=Date.now()+e,this.rotXVel=Math.random()*n+n,this.rotYVel=-.02}isDoneRolling(t=Date.now()){return t>=this.rollStopTime+200}shouldBeResolved(t=Date.now()){return t>=this.rollStopTime-200}}function Kt(t){return t*Math.PI/180}const Jt=t=>document.getElementById(t),Qt={x:-1,y:-1},te={},ee=Jt("leftBtn"),ne=Jt("rightBtn");function re(){ee.disabled||(ee.disabled=!0,setTimeout((()=>ee.disabled=!1),200)),ne.disabled||(ne.disabled=!0,setTimeout((()=>ne.disabled=!1),200))}function ie(t,e,n,r){ee.disabled=!0,ne.disabled=!0,setTimeout((()=>{ee.innerText=t,ne.innerText=e,ee.onclick=n,ne.onclick=r,ee.disabled=!1,ne.disabled=!1}),150)}ee.addEventListener("click",(()=>{re()})),ne.addEventListener("click",(()=>{re()}));const se=80;class oe{constructor(t=5){this.n=t,this.size=t*se,this.halfsize=t*se/2,this.leftEdge=_e/2-this.halfsize,this.topEdge=Fe-this.size-240,this.grid=new Array(t*t).fill(null),this.allResolved=!0,this.hArrows=new Array(t).fill(!1),this.vArrows=new Array(t).fill(!1),this.selectedLine=null}getSelectedLine(){return this.selectedLine?"v"===this.selectedLine[0]?this.getCol(this.selectedLine[1]):"h"===this.selectedLine[0]?this.getRow(this.selectedLine[1]):void 0:[]}rerollSelectedLine(){this.selectedLine&&("v"===this.selectedLine[0]?this.rerollCol(this.selectedLine[1]):"h"===this.selectedLine[0]&&this.rerollRow(this.selectedLine[1]))}deselectLine(){this.selectedLine=null,ie(`ROLL (üçå${Ee.activeCost})`,"SWEEP (üçå2)",Qe,tn)}rerollRow(t){if(t<0||t>=this.n)return;const e=t*this.n;for(let t=0;t<this.n;t++)this.grid[e+t]?.roll()}rerollCol(t){if(t<0||t>=this.n)return;const e=t;for(let t=0;t<this.n;t++)this.grid[e+t*this.n]?.roll()}getRow(t){const e=[];if(t<0||t>=this.n)return e;const n=t*this.n;for(let t=0;t<this.n;t++)e.push(this.grid[n+t]);return e}getCol(t){const e=[];if(t<0||t>=this.n)return e;const n=t;for(let t=0;t<this.n;t++)e.push(this.grid[n+t*this.n]);return e}contains(t,e){return!(t<this.leftEdge||t>=this.leftEdge+this.size||e<this.topEdge||e>=this.topEdge+this.size)}outerContains(t,e){return!(t<this.leftEdge-se||t>=this.leftEdge+this.size+se||e<this.topEdge-se||e>=this.topEdge+this.size+se)}getDiceAtXY(t,e){if(!this.contains(t,e))return;const n=t-this.leftEdge,r=e-this.topEdge,i=Math.floor(n/se),s=Math.floor(r/se);return this.getDiceAtRC(s,i)}getConnectedColors(t){if(!t)return[];if("gray"===t.color)return[];const e=this.grid.findIndex((e=>e===t));if(-1==e)return[];const n=Math.floor(e/this.n),r=e%this.n;return this.connectedColorsTraverse(t.color,n,r)}connectedColorsTraverse(t,e,n,r=[]){const i=this.getDiceAtRC(e,n);if(i&&!r.includes(i)&&i.resolved&&i.color===t)return r.push(i),this.connectedColorsTraverse(t,e+1,n,r),this.connectedColorsTraverse(t,e-1,n,r),this.connectedColorsTraverse(t,e,n+1,r),this.connectedColorsTraverse(t,e,n-1,r),r}uncolorAndReroll(t){for(let e=0;e<t.length;e++){const n=t[e];n.colors[n.faceIdx]="gray",n.remapFaces(),n.particleSpiral(),n.doDelayedReroll()}}getArrowAtXY(t,e){if(this.contains(t,e))return null;if(!this.outerContains(t,e))return null;const n=t-this.leftEdge,r=e-this.topEdge,i=Math.floor(n/se),s=Math.floor(r/se);return(-1===i||i===this.n)&&s<this.n&&s>=0?this.anyDiceInRow(s)?["h",s]:null:(-1===s||s===this.n)&&i<this.n&&i>=0?this.anyDiceInCol(i)?["v",i]:null:void 0}selectArrowAtXY(t,e){const n=this.selectedLine;return this.selectedLine=this.getArrowAtXY(t,e),this.selectedLine?(ie(Ce.isSubmittable(this.getSelectedLine())?"SUBMIT!":"REMOVE",`REROLL (üçå${4+Ie})`,Qe,tn),!0):(n&&this.deselectLine(),!1)}getDiceAtRC(t,e){if(!(t<0||t>=this.n||e<0||e>=this.n))return this.grid[t*this.n+e]}removeAt(t,e){this.grid[t*this.n+e]=null,this.anyDiceInCol(e)||(this.vArrows[e]=!1),this.anyDiceInRow(t)||(this.hArrows[t]=!1)}remove(t){this.removeAt(Math.floor(t/this.n),t%this.n)}removeDice(t){const e=this.grid.findIndex((e=>e===t));this.remove(e)}hasSpace(){return this.grid.some((t=>null===t))}addDiceSequential(t){const e=this.grid.findIndex((t=>null===t));if(-1==e)return;const n=Math.floor(e/this.n),r=e%this.n;this.addDice(t,n,r)}addDiceRandomLoc(t){const e=this.grid.map(((t,e)=>t?null:e)).filter((t=>null!==t));if(0==e.length)return;const n=Ge(e),r=Math.floor(n/this.n),i=n%this.n;this.addDice(t,r,i)}addDice(t,e,n){this.vArrows[n]=!0,this.hArrows[e]=!0,t.x=this.leftEdge+n*se+40,t.y=this.topEdge+e*se+40,t.x+=Ye(-2,2),t.y+=Ye(-2,2),this.grid[e*this.n+n]=t}anyDiceInCol(t){for(let e=0;e<this.n;e++)if(this.grid[t+e*this.n])return!0;return!1}anyDiceInRow(t){for(let e=0;e<this.n;e++)if(this.grid[t*this.n+e])return!0;return!1}drawSelectedLine(t){if(this.selectedLine)if("v"===this.selectedLine[0]){const e=this.selectedLine[1];le(t,"#dd0",this.leftEdge+e*se,this.topEdge,se,this.size,10,4,"#8a7611")}else if("h"===this.selectedLine[0]){const e=this.selectedLine[1];le(t,"#dd0",this.leftEdge,this.topEdge+e*se,this.size,se,10,4,"#8a7611")}}draw(t){for(let e=0;e<this.grid.length;e++){const n=this.grid[e];if(n){let r=Math.sin(.005*Date.now()+e*Math.PI/.81);t.save(),t.translate(r,0),n.draw(t),t.restore()}}if(this.allResolved){this.drawSelectedLine(t);for(let e=0;e<this.n;e++){if(!this.vArrows[e])continue;let n=this.leftEdge+e*se,r=5*Math.sin(.005*Date.now()+e*Math.PI/.81),i=this.topEdge-se+r,s=this.topEdge+this.size-r;t.drawImage(Yt.arrowDown,n,i,se,se),t.drawImage(Yt.arrowUp,n,s,se,se)}for(let e=0;e<this.n;e++){if(!this.hArrows[e])continue;let n=this.topEdge+e*se,r=5*Math.sin(.005*Date.now()+e*Math.PI/.81),i=this.leftEdge-se+r,s=this.leftEdge+this.size-r+10;t.drawImage(Yt.arrowRight,i,n,se,se),t.drawImage(Yt.arrowLeft,s,n,se,se)}}}update(){this.allResolved=!0;for(let t=0;t<this.grid.length;t++){const e=this.grid[t];e&&(e.update(),e.resolved||(this.allResolved=!1))}}}const ae=Math.PI;function le(t,e,n,r,i,s,o,a,l,c){l&&(t.save(),t.translate(3,3),t.beginPath(),t.arc(n+o,r+o,o,1.5*ae,ae,!0),t.arc(n+o,r+s-o,o,ae,.5*ae,!0),t.arc(n+i-o,r+s-o,o,.5*ae,0,!0),t.arc(n+i-o,r+o,o,0,1.5*ae,!0),t.closePath(),t.strokeStyle=l,t.lineWidth=a,t.stroke(),t.restore()),t.beginPath(),t.arc(n+o,r+o,o,1.5*ae,ae,!0),t.arc(n+o,r+s-o,o,ae,.5*ae,!0),t.arc(n+i-o,r+s-o,o,.5*ae,0,!0),t.arc(n+i-o,r+o,o,0,1.5*ae,!0),t.closePath(),t.strokeStyle=e,t.lineWidth=a,t.stroke(),c&&(t.fillStyle=c,t.fill())}let ce=2*Math.PI;const ue={parts:[],update:function(){let t=this.parts.length;for(let e=0;e<t;e++)this.parts[e].update?this.parts[e].update():(this.parts.splice(e--,1),t--)},draw:function(t){for(let e of this.parts)e.draw&&e.draw(t)},addPart:function(t,e,n){this.parts.push(he(t,e,n))},explode:function(t,e,n,r=20,i=4){for(let s=0;s<r;s++)this.parts.push(he(t,e,n,i))},spiral:function(t,e,n,r=20,i=4){for(let s=0;s<r;s++)this.parts.push(fe(t,e,n,i))},addSpiralPart:function(t,e){this.parts.push(fe(t,e))}};function he(t,e,n,r){return{ox:t,oy:e,x:t,y:e,r:1+r*Math.random(),v:.8,color:n,theta:Math.random()*ce,draw:function(t){t.beginPath();let e=t.lineWidth;t.lineWidth=1,t.fillStyle=this.color,t.arc(this.x,this.y,this.r,0,ce),t.fill(),t.closePath(),t.lineWidth=e},update:function(){if(this.x+=this.v*this.r*Math.cos(this.theta),this.y+=this.v*this.r*Math.sin(this.theta),this.r-=.1,this.r<=0)return this.update=null,void(this.draw=()=>{});this.theta+=.3-.6*Math.random()}}}function fe(t,e,n,r){return{ox:t,oy:e,x:t,y:e,r:1+r*Math.random(),v:10,color:n,theta:Math.random()*ce,draw:function(t){t.beginPath(),t.lineWidth=.2,t.fillStyle=this.color,t.arc(this.x,this.y,this.r,0,ce),t.fill()},update:function(){if(this.x+=this.r*Math.cos(this.theta),this.y+=this.r*Math.sin(this.theta),this.r-=.1,this.r<=0)return this.update=null,void(this.draw=()=>{});this.theta+=.05}}}class de{constructor(){this.ctx=document.createElement("canvas").getContext("2d"),this.ctx.canvas.width=500,this.ctx.canvas.height=500,le(this.ctx,"#dd0",10,20,98,190,10,4,"#8a7611","#CCC"),this.ctx.drawImage(Yt.gray,20,30,50,50),this.ctx.drawImage(Yt.glyph1,20,30,50,50),this.ctx.drawImage(Yt.gray,20,90,50,50),this.ctx.drawImage(Yt.glyph2,20,90,50,50),this.ctx.drawImage(Yt.gray,20,150,50,50),this.ctx.drawImage(Yt.glyph3,20,150,50,50),this.faces={glyph1:!1,glyph2:!1,glyph3:!1}}isSubmittable(t){if(t.length<3)return!1;if(t.some((t=>!t)))return!1;const e=t[0].face;return e in this.faces&&!t.some((t=>t.face!=e))}submitDice(t){if(!this.isSubmittable(t))return;const e=t[0].face;this.faces[e]=!0,"glyph1"===e?(ue.spiral(65,70,"lime",30,10),Me.addBananas(10,65,70)):"glyph2"===e?(ue.spiral(65,130,"lime",30,10),Me.addBananas(10,65,130)):"glyph3"===e&&(ue.spiral(65,190,"lime",30,10),Me.addBananas(10,65,190)),this.faces.glyph1&&this.faces.glyph2&&this.faces.glyph3&&(ue.spiral(_e/2,Fe/2,"lime",60,20),ue.spiral(_e/2,Fe/2,"white",60,20),ue.spiral(_e/2,Fe/2,"green",60,20),setTimeout(ke,1e3)),Gt.win.currentTime=0,Gt.win.play()}draw(t){t.drawImage(this.ctx.canvas,0,0);const e=`x${Ie+2}`;t.textAlign="left",t.fillStyle="#dd0",t.fillText(e,63,68),t.fillText(e,63,128),t.fillText(e,63,188),t.fillStyle="#8a7611",t.fillText(e,65,70),t.fillText(e,65,130),t.fillText(e,65,190),this.faces.glyph1&&t.drawImage(Yt.check,22,0),this.faces.glyph2&&t.drawImage(Yt.check,22,60),this.faces.glyph3&&t.drawImage(Yt.check,22,120)}}class pe{constructor(){this.diceCount=0,this.dice=new He(we(0),We(),260,100),this.dice.renderer.rollStopTime=Date.now()+99999999,this.dice.renderer.rotXVel=.001,this.dice.renderer.rotYVel=-.005,this.sweepTime=Date.now(),this.didSweep=!0,this.activeCost=1,ee.innerText=`ROLL (üçå${this.activeCost})`}incrementActiveCost(){this.activeCost+=Math.round(this.activeCost/2),ee.innerText=`ROLL (üçå${this.activeCost})`}startSweep(){this.didSweep=!1,this.sweepTime=Date.now()+200}sweep(){this.diceCount++,this.activeCost=1,ee.innerText=`ROLL (üçå${this.activeCost})`;const t=we(this.diceCount);this.dice.faces=t,this.dice.colors=function(){const t=Math.random();let e;return e=t<.25?["red","red","red","red",Ge(ge),Ge(ge)]:t<.5?["green","green","green","green",Ge(ge),Ge(ge)]:t<.5?["blue","blue","blue","blue",Ge(ge),Ge(ge)]:We(),e}(),this.dice.remapFaces(),this.dice.renderer.rollStopTime=Date.now()+99999999}update(){!this.didSweep&&Date.now()>this.sweepTime&&(this.sweep(),this.didSweep=!0)}draw(t){if(Date.now()<this.sweepTime){let e=1-(this.sweepTime-Date.now())/200;t.save(),t.globalAlpha=1-e,t.translate(300*e,0),this.dice.draw(t),t.restore()}else if(Date.now()-100<this.sweepTime){let e=-(this.sweepTime-Date.now())/200*2;t.save(),t.globalAlpha=1-e,t.translate(0,50*e-50),this.dice.draw(t),t.restore()}else this.dice.draw(t)}}const ge=["red","blue","green","red","blue","green"];let me=["onebanana","onebanana","onebanana","onebanana","onebanana","splitbanana","threebanana","threebanana"],ye=["onebanana","splitbanana","threebanana","glyph1","glyph2","glyph3"];function we(t){return t<5?[Ge(me),Ge(me),Ge(me),Ge(me),Ge(me),Ge(me)]:[Ge(ye),Ge(ye),Ge(ye),Ge(ye),Ge(ye),Ge(ye)]}class be{constructor(){this.bananas=20,this.messages=[]}loseBananas(t){this.bananas-=t,this.messages.push(new xe(t,580,145))}addBananas(t,e,n){this.bananas+=t,this.messages.push(new Ae(t,e,n)),this.shakeCountdown=0}startShake(){this.shakeCountdown=30}update(){for(let t=0;t<this.messages.length;t++)this.messages[t].isExpired()&&this.messages.splice(t--,1);this.shakeCountdown>0&&this.shakeCountdown--}draw(t){t.font="bold 30px 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif",t.textAlign="right",t.fillStyle="#8a7611",t.fillText(`üçå${this.bananas}`,580,140),this.shakeCountdown>0&&this.shakeCountdown%6>2?t.fillStyle="#d00":t.fillStyle="#dd0",t.fillText(`üçå${this.bananas}`,582,142);for(let e=0;e<this.messages.length;e++)this.messages[e].draw(t)}}const ve=1e3;class Ae{constructor(t,e,n){this.x=e,this.y=n,this.num=t,this.endTime=Date.now()+ve}isExpired(){return Date.now()>this.endTime}draw(t){const e=(this.endTime-Date.now())/ve,n=this.y-50+50*e;t.save(),t.globalAlpha=e,t.font="bold 30px 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif",t.textAlign="center",t.fillStyle="#8a7611",t.fillText(`+${this.num}`,this.x-2,n-2),t.fillStyle="#dd0",t.fillText(`+${this.num}`,this.x,n),t.restore()}}class xe{constructor(t,e,n){this.x=e,this.y=n,this.num=t,this.endTime=Date.now()+ve}isExpired(){return Date.now()>this.endTime}draw(t){const e=(this.endTime-Date.now())/ve,n=this.y+50-50*e;t.save(),t.globalAlpha=e,t.font="bold 30px 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif",t.textAlign="center",t.fillStyle="#d00",t.fillText(`-${this.num}`,this.x-2,n-2),t.fillStyle="#dd0",t.fillText(`-${this.num}`,this.x,n),t.restore()}}let Te,Ee,Ce,Me=new be,Ie=1;function Se(){Ie=1,Te=new oe(3),Ce=new de,Ee=new pe,Me=new be}function Le(){Ie=2,Te=new oe(4),Ce=new de,Ee=new pe,Me=new be;let t=new He([...Ee.dice.faces],[...Ee.dice.colors]);t.roll(),Te.addDiceRandomLoc(t),Te.update();let e=new He([...Ee.dice.faces],[...Ee.dice.colors]);e.roll(),Te.addDiceRandomLoc(e),Te.update()}function Re(){Ie=3,Te=new oe(5),Ce=new de,Ee=new pe,Me=new be;let t=new He([...Ee.dice.faces],[...Ee.dice.colors]);t.roll(),Te.addDiceRandomLoc(t),Te.update();let e=new He([...Ee.dice.faces],[...Ee.dice.colors]);e.roll(),Te.addDiceRandomLoc(e),Te.update()}function ke(){1===Ie?Le():2===Ie?Re():3===Ie&&Ve.gotoCredits()}class Pe{constructor(){this.state=-1,this.keepTicking=!1,this.update=()=>{},this.draw=()=>{}}static get MENU(){return 0}static get PAUSE(){return 1}static get GAME(){return 2}static get CRED(){return 3}static get TUTORIAL1(){return 4}static get TUTORIAL2(){return 5}inState(t){return this.state==t}gotoMenu(){ee.classList.remove("nodisp"),ne.classList.remove("nodisp"),this.keepTicking=!1,this.state=Pe.MENU,Xe.drawImage(Yt.menu,0,0,_e,Fe),this.update=()=>{},this.draw=()=>{Xe.drawImage(Yt.menu,0,0,_e,Fe)},ie("PLAY","CREDITS",(()=>this.gotoTutorial1()),(()=>this.gotoCredits()))}gotoCredits(){ee.classList.remove("nodisp"),ne.classList.remove("nodisp"),this.keepTicking=!0,this.state=Pe.CRED,Xe.clearRect(0,0,_e,Fe),Xe.drawImage(Yt.credits,0,0,_e,Fe);const t=[new He(["E","E","E","M","I","I"],["gray","red","green","green","blue","red"],100,100),new He(["D","D","D","A","M","M"],["gray","red","green","green","blue","red"],200,100),new He(["R","R","R","G","A","A"],["gray","red","green","green","blue","red"],300,100),new He(["I","I","I","I","N","N"],["gray","red","green","green","blue","red"],400,100),new He(["C","C","C","C","I","I"],["gray","red","green","green","blue","red"],500,100)];t.forEach((t=>t.rollToFace(0))),this.draw=()=>function(t,e){t.clearRect(0,0,_e,Fe),t.drawImage(Yt.credits,0,0,_e,Fe),e.forEach((e=>{e.draw(t)}))}(Xe,t),this.update=()=>{},requestAnimationFrame(this.tick.bind(this)),ie("BACK","DO MAGIC",(()=>this.gotoMenu()),(()=>{const e=Ye(0,5);t.forEach((t=>t.rollToFace(e)))}))}gotoTutorial1(){ee.classList.add("nodisp"),ne.classList.add("nodisp"),this.keepTicking=!1,this.state=Pe.TUTORIAL1,this.draw=()=>De(Xe),De(Xe)}gotoTutorial2(){ee.classList.add("nodisp"),ne.classList.add("nodisp"),this.keepTicking=!1,this.state=Pe.TUTORIAL2,this.draw=()=>Be(Xe),Be(Xe)}gotoGame(){ee.classList.remove("nodisp"),ne.classList.remove("nodisp"),this.keepTicking=!0,this.state=Pe.GAME,this.update=Ke,this.draw=Je,requestAnimationFrame(this.tick.bind(this)),ie("ROLL (üçå1)","SWEEP (üçå2)",Qe,tn),Se()}tick(){let t=performance.now(),e=t-ze;for(ze=t,Ue+=e;Ue>=$e;)this.update(),Ue-=$e;this.draw(),this.keepTicking&&requestAnimationFrame(this.tick.bind(this))}}let ze=performance.now(),Ue=0;function De(t){t.clearRect(0,0,_e,Fe),t.drawImage(Yt.tutorial1,0,0,_e,Fe)}function Be(t){t.clearRect(0,0,_e,Fe),t.drawImage(Yt.tutorial2,0,0,_e,Fe)}const _e=600,Fe=1e3,Oe=Jt("canvas"),Xe=Oe.getContext("2d"),$e=1e3/60,Ve=new Pe;function Ye(t,e){const n=e-t+1;return Math.floor(t+Math.random()*n)}function Ge(t){const e=t.length;return t[Math.floor(Math.random()*e)]}const Ne=["red","blue","green","red","blue","green"],We=t=>((t=>{for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*e),r=t[e];t[e]=t[n],t[n]=r}})(Ne),[...Ne]),je={red:"#df4a36",blue:"#2aadda",green:"#60cb9f",gray:"#999"};class He{constructor(t,e,n=0,r=0){this.renderer=new Zt(t,e),this.faces=t,this.colors=e,this.faceIdx=0,this.face,this.color,this.resolved=!1,this.x=n,this.y=r,this.rerollCountdown=0}get face(){return this.faces[this.faceIdx]}get color(){return this.colors[this.faceIdx]}doDelayedReroll(t=20){this.rerollCountdown=t}remapFaces(){this.renderer.mapFaces(this.faces,this.colors),this.renderer.draw(this.renderer.bufferCtx,this.x,this.y,!0)}particleExplode(){ue.explode(this.x,this.y,je[this.color])}particleSpiral(){ue.explode(this.x,this.y,je[this.color])}update(){if(this.rerollCountdown>0)return this.rerollCountdown--,void(1===this.rerollCountdown&&this.roll());if(!this.resolved&&this.renderer.shouldBeResolved()){this.resolved=!0;const t=Ge(["clunk1","clunk2","clunk3","clunk4"]),e=Gt[t];e.currentTime=0,e.play(),ue.explode(this.x,this.y,je[this.color]),"onebanana"===this.face?Me.addBananas(1,this.x,this.y):"threebanana"===this.face&&Me.addBananas(3,this.x,this.y)}}draw(t){this.renderer.draw(t,this.x,this.y)}roll(){this.rollToFace(Ye(0,5))}rollToFace(t){this.resolved=!1,this.faceIdx=t;const e=Ye(1e3,2e3);this.renderer.roll(t,e,.01+Math.random()/2)}}let qe=0,Ze=!1;function Ke(){Te.update(),ue.update(),Me.update(),Ee.update(),Me.bananas<2?(qe++,100===qe||200===qe?(Gt.blip.currentTime=0,Gt.blip.play()):300===qe&&(Gt.blip.currentTime=0,Gt.blip.play(),Ze=!0,ie("RETRY","EXIT",(()=>{1===Ie?Se():2===Ie?Le():3===Ie&&Re(),ie("ROLL (üçå1)","SWEEP (üçå2)",Qe,tn),Ze=!1}),(()=>{Ve.gotoMenu(),Ze=!1})))):qe=0}function Je(){Xe.clearRect(0,0,_e,Fe),Xe.drawImage(Yt.background,0,0,_e,Fe),Ce.draw(Xe),ue.draw(Xe),Te.draw(Xe),Me.draw(Xe),Ee.draw(Xe),Ze?(Xe.save(),Xe.globalAlpha=.5,Xe.fillStyle="black",Xe.fillRect(0,0,_e,Fe),Xe.restore(),Xe.drawImage(Yt.dead,_e/2-200,Fe/2-200,400,400)):qe>150?(Xe.save(),Xe.globalAlpha=qe%10>2?1:.5,Xe.drawImage(Yt.dead,_e-100,30,100,100),Xe.restore()):Me.bananas>20?Xe.drawImage(Yt.happy,_e-100,30,100,100):Me.bananas>1?Xe.drawImage(Yt.neutral,_e-100,30,100,100):Xe.drawImage(Yt.dead,_e-100,30,100,100)}function Qe(){if(Te.selectedLine){const t=Te.getSelectedLine();Te.deselectLine(),Ce.submitDice(t),t.forEach((t=>t&&Te.removeDice(t)))}else{if(Ee.activeCost>Me.bananas)return void Me.startShake();if(!Te.hasSpace())return;Me.loseBananas(Ee.activeCost),Ee.diceCount++;let t=new He([...Ee.dice.faces],[...Ee.dice.colors]);t.roll(),Te.addDiceRandomLoc(t),Te.update(),Ee.incrementActiveCost()}}function tn(){if(Te.selectedLine){if(Me.bananas<4+Ie)return void Me.startShake();Me.loseBananas(4+Ie),Te.rerollSelectedLine(),Te.deselectLine()}else{if(Me.bananas<=1)return void Me.startShake();Ee.startSweep(),Me.loseBananas(2)}}Oe.addEventListener("mousedown",(t=>{t.preventDefault();let e=t.button;te[e]=!0})),Oe.addEventListener("mouseup",(t=>{let e=t.button;te[e]=!1})),Oe.addEventListener("mousemove",(t=>{Qt.x=Math.round(t.offsetX*Oe.width/Oe.clientWidth),Qt.y=Math.round(t.offsetY*Oe.height/Oe.clientHeight)})),Oe.addEventListener("click",(t=>{Qt.x=Math.round(t.offsetX*Oe.width/Oe.clientWidth),Qt.y=Math.round(t.offsetY*Oe.height/Oe.clientHeight),function(t,e){if(Ve.inState(Pe.TUTORIAL1)?Ve.gotoTutorial2():Ve.inState(Pe.TUTORIAL2)&&Ve.gotoGame(),Ze)return;if(!Ve.inState(Pe.GAME))return;if(Te.allResolved&&Te.selectArrowAtXY(t,e))return;const n=Te.getDiceAtXY(t,e);if(n){const t=Te.getConnectedColors(n);if(t.length<=1)return;t.forEach((t=>{Me.addBananas(1,t.x,t.y)})),Te.uncolorAndReroll(t),Gt.shoop.currentTime=0,Gt.shoop.play()}}(Qt.x,Qt.y)})),function(){!function(){for(let t in $t)Yt[t]=new Image,Yt[t].src=$t[t],Yt[t].onload=Nt;for(let t in Vt)Gt[t]=new Audio(Vt[t]),Gt[t].onloadeddata=Nt}();let t=setInterval((()=>{Yt.menu&&!Ve.inState(Pe.MENU)&&Ve.gotoMenu(),Xt==Object.keys($t).length+Object.keys(Vt).length&&(ee.disabled=!1,ne.disabled=!1,clearInterval(t))}),500)}()})();